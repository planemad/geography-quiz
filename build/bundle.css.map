{
  "version": 3,
  "file": "bundle.css",
  "sources": [
    "App.svelte",
    "Map.svelte",
    "Panel.svelte"
  ],
  "sourcesContent": [
    "<!-- \n  How the map quiz works:\n  1. Download a list of countries with an ISO 3166-1 code from Wikidata\n  2. Randomly choose one country for the round\n\n-->\n<script>\n  import Map from \"./Map.svelte\";\n  import { getWorldview } from \"./utils.js\";\n  import Panel from \"./Panel.svelte\";\n\n  import { queryWikidata, shuffle } from \"./utils.js\";\n  import { parse } from \"./wellknown.js\";\n  import fetchTimeout from \"fetch-timeout\";\n  import countriesLookup from \"./data/mapbox-countries-v1.json\";\n\n  let map = null;\n\n  let settings = {\n    locale: navigator.language,\n    language: navigator.language.split(\"-\")[0] || \"en\",\n    userLocation: null,\n    fallbackLanguage: \"en\",\n    mapWorldview: \"US\", // Set worldview to use for disputed areas\n    mapStyle: \"mapbox://styles/planemad/ckgopajx83l581bo6qr5l86yg\",\n    choices: 4,\n    viewportWidth: window.innerWidth,\n    startingCountryQid: null,\n    difficultyLevel: 0,\n    difficultyLevels: [\"😊\", \"😅\", \"😂\"],\n  };\n\n  let game = {\n    dataLoaded: false,\n    showIntro: true,\n    turn: 0,\n    score: 0,\n    endTurn: false,\n    place: null,\n    choices: null,\n    answerIsCorrect: null,\n    answerHistory: {},\n    choices: [],\n  };\n\n  // Customize to user language and location\n\n  detectLocation();\n\n  function detectLocation() {\n    settings.language = settings.locale.split(\"-\")[0];\n\n    // Locate user country from IP\n    fetchTimeout(\n      \"https://freegeoip.app/json/\",\n      {},\n      2000,\n      \"Geoip detection timed out\"\n    )\n      .then((res) => {\n        if (res.status !== 200) {\n          throw new Error(\"Status code not OK\", res);\n        } else {\n          return res.json();\n        }\n      })\n      .then((json) => {\n        settings.mapWorldview = getWorldview(\n          json.country_code,\n          settings.locale\n        );\n        settings.userLocation = {\n          iso_3166_1: json.country_code,\n          iso_3166_2: json.country_code + \"-\" + json.region_code,\n          lngLat: {\n            lng: json.longitude,\n            lat: json.latitude,\n          },\n        };\n\n        if (settings.locale.split(\"-\").length == 1) {\n          settings.locale += \"-\" + settings.userLocation.iso_3166_1;\n        }\n\n        // DEBUG: app settings\n        console.log(\"Detected settings\", settings);\n      })\n      .catch((err) => {\n        console.log(\"error\", err);\n      });\n  }\n\n  // Build a master list of Wikidata qids to query from the Mapbox Countries list\n  // Filter by selected worldview and undisputed countries\n  let countriesData = countriesLookup\n    .filter(\n      (d) =>\n        (d.worldview == \"all\" || d.worldview == settings.mapWorldview) &&\n        (d.description == \"sovereign state\" ||\n          d.description == \"dependent territory\")\n      // DEBUG: Filter specific countries\n      // (d.wikidata_id == \"Q142\" ||\n      //   d.wikidata_id == \"Q1044\" ||\n      //   d.wikidata_id == \"Q1049\" ||\n      //   d.wikidata_id == \"Q237\")\n    )\n    .reduce((a, b) => ((a[b.wikidata_id] = b), a), {});\n\n  let countryQids = Object.keys(countriesData);\n\n  // TODO: Randomize starting country\n  // settings.startingCountryQid = countryQids[(250 * Math.random()) << 0];\n\n  // Get list of countries from Wikidata\n  let sparql = `\n  # List of all countries based on ISO 3166-2 country code with their capitals \n  SELECT DISTINCT  (SAMPLE(?location) as ?location) ?country ?countryLabel (SAMPLE(?capital) as ?capital) (SAMPLE(?capitalLabel) as ?capitalLabel) (SAMPLE(?flag) as ?flag) WHERE {\n  VALUES ?country { ${countryQids.join(\" \").replace(/Q/g, \"wd:Q\")}}\n  OPTIONAL { ?country wdt:P625 ?location }.\n  OPTIONAL { ?country wdt:P41 ?flag }.\n  OPTIONAL { ?country wdt:P36 ?capital }.\n    # Retrieve labels to enable group_concat \n    # https://stackoverflow.com/questions/48855767/group-concat-not-working\n    SERVICE wikibase:label {\n    bd:serviceParam wikibase:language \"${settings.language},${\n    settings.fallbackLanguage\n  }\". \n    ?country rdfs:label ?countryLabel . \n    ?capital rdfs:label ?capitalLabel . \n  }\n  }\nGROUP BY ?country ?countryLabel\nORDER BY ?countryLabel\n`;\n  queryWikidata(sparql).then((result) => {\n    // Join the Wikidata results to the country data object using the qid as lookup key\n    result.forEach((d) => {\n      let qid = d.country.value.replace(\"http://www.wikidata.org/entity/\", \"\");\n\n      // Retain only those territories that have a flag from the master list\n      if (d.hasOwnProperty(\"flag\")) {\n        Object.assign(countriesData[qid], d);\n        countriesData[qid].wikidata = d;\n        // Augment JSON data from WIkidata results\n        countriesData[qid].name_lang = d.countryLabel.value;\n      } else {\n        delete countriesData[qid];\n      }\n    });\n\n    if (!game.dataLoaded) {\n      game.dataLoaded = true;\n      map.easeTo({\n        bearing: 180,\n        duration: 1000,\n      });\n    }\n  });\n\n  // New turn. Randomly select a place + get its location\n  function nextTurn() {\n    window.scrollTo(0, 0);\n\n    game.endTurn = false;\n\n    map.setPaintProperty(\"country-boundaries\", \"fill-opacity\", 0);\n\n    // Pick a country not yet answered for the round\n\n    let allKeys = Object.keys(countriesData).sort((a, b) => a.localeCompare(b));\n    let unansweredKeys = [];\n\n    allKeys.forEach((k) => {\n      if (!Object.keys(game.answerHistory).includes(k)) {\n        unansweredKeys.push(k);\n      }\n    });\n\n    // Pick a random country key\n    game.correctAnswer = null;\n    while ( game.correctAnswer == null ) {\n      // console.log(game.correctAnswer)\n      let selectedKey = unansweredKeys[(unansweredKeys.length * Math.random()) << 0]\n        let selectedCountry = countriesData[selectedKey]\n        \n        // Decide minimum country size by difficulty level\n        if(settings.difficultyLevel == 0 && parseInt(selectedCountry.area_sqkm)>500000){\n          game.correctAnswer = selectedCountry\n        }\n        if(settings.difficultyLevel == 1 && parseInt(selectedCountry.area_sqkm)>50000){\n          game.correctAnswer = selectedCountry\n        }\n        if(settings.difficultyLevel == 2 ){\n          game.correctAnswer = selectedCountry\n        }\n    }\n    game.answerHistory[game.correctAnswer.wikidata_id] = [];\n\n    game.choices = [];\n    game.choices.push(game.correctAnswer);\n\n    // Add choices similiar to the selected key\n    allKeys.forEach((k) => {\n      if (\n        k != game.correctAnswer.wikidata_id &&\n        countriesData[k].subregion == game.correctAnswer.subregion &&\n        game.choices.length < settings.choices\n      )\n        game.choices.push(countriesData[k]);\n    });\n    allKeys.forEach((k) => {\n      if (\n        k != game.correctAnswer.wikidata_id &&\n        countriesData[k].region == game.correctAnswer.region &&\n        game.choices.length < settings.choices\n      )\n        game.choices.push(countriesData[k]);\n    });\n\n    // Shuffle order of choices\n    game.choices = shuffle(game.choices);\n\n    // Add a location marker to the map for the country\n    // Use the location of the capital if available\n    // Else use the country centroid\n\n    let hasCapital = game.correctAnswer.hasOwnProperty(\"capital\");\n\n    let query = `\n      select ${\n        hasCapital ? \"(SAMPLE(?capitalLocation) as ?capitalLocation)\" : \"\"\n      } ?anthemLabel ?anthemAudio ?coatOfArms (GROUP_CONCAT(DISTINCT ?officialLanguageLabel; SEPARATOR=\", \") AS ?officialLanguageLabels) (GROUP_CONCAT(DISTINCT ?spokenLanguageLabel; SEPARATOR=\", \") AS ?spokenLanguageLabels) (SAMPLE(?website) AS ?website)  (GROUP_CONCAT(DISTINCT ?namedAfterLabel; SEPARATOR=\", \") AS ?namedAfterLabels) (SAMPLE(?pageBanner) as ?pageBanner) where {\n\n        OPTIONAL {  wd:${game.correctAnswer.wikidata_id}  wdt:P85 ?anthem }.\n        OPTIONAL { ?anthem wdt:P51 ?anthemAudio }.\n        \n        OPTIONAL { wd:${game.correctAnswer.wikidata_id} wdt:P94 ?coatOfArms }.\n        OPTIONAL { wd:${game.correctAnswer.wikidata_id} wdt:P856 ?website }.\n        OPTIONAL { wd:${game.correctAnswer.wikidata_id} wdt:P138 ?namedAfter}.\n        OPTIONAL { wd:${game.correctAnswer.wikidata_id} wdt:P948 ?pageBanner}.\n        OPTIONAL { wd:${\n          game.correctAnswer.wikidata_id\n        } wdt:P37 ?officialLanguage }.\n        OPTIONAL { wd:${\n          game.correctAnswer.wikidata_id\n        } wdt:P2936 ?spokenLanguage }.\n\n        ${\n          hasCapital\n            ? `OPTIONAL { wd:${game.correctAnswer.capital.value.replace(\n                \"http://www.wikidata.org/entity/\",\n                \"\"\n              )} wdt:P625 ?capitalLocation }.`\n            : \"\"\n        }\n        \n      service wikibase:label { bd:serviceParam wikibase:language \"${\n        settings.language\n      },${settings.fallbackLanguage}\". \n      ?officialLanguage rdfs:label ?officialLanguageLabel .\n      ?spokenLanguage rdfs:label ?spokenLanguageLabel .\n      ?namedAfter rdfs:label ?namedAfterLabel .\n      ?anthem rdfs:label ?anthemLabel .\n      }\n      }\n      GROUP BY ?anthemLabel ?anthemAudio ?coatOfArms\n      `;\n\n    queryWikidata(query).then((result) => {\n      game.correctAnswer.wikidata = Object.assign(\n        result[0],\n        game.correctAnswer.wikidata\n      );\n      // DEBUG: Inspect answer data\n      // console.log(query, countriesData, game.correctAnswer);\n\n      // Build a point feature for the territory using the capital or centroid data\n      let pointLocation;\n      if (result[0].hasOwnProperty(\"capitalLocation\")) {\n        pointLocation = Object.assign(\n          {\n            type: \"Feature\",\n            properties: {\n              name: game.correctAnswer.capitalLabel.value,\n              type: \"capital\",\n            },\n          },\n          parse(game.correctAnswer.wikidata.capitalLocation.value)\n        );\n      } else {\n        pointLocation = {\n          type: \"Feature\",\n          properties: {\n            name: game.correctAnswer.name_lang,\n            type: \"centroid\",\n          },\n          geometry: {\n            type: \"Point\",\n            coordinates: JSON.parse(game.correctAnswer.centroid),\n          },\n        };\n      }\n      map.getSource(\"capital-location\").setData(pointLocation);\n    });\n\n    // Update boundary\n\n    styleMap(game.correctAnswer.iso_3166_1);\n\n    // Pan to place\n\n    map.fitBounds(JSON.parse(game.correctAnswer.bounds), {\n      padding: document.getElementById(\"map\").offsetWidth * 0.1,\n      duration: 1000,\n      bearing: settings.difficultyLevel >= 1 ? Math.random() * 360 : 0,\n      maxZoom: 9,\n    });\n\n    map.setPaintProperty(\"country-boundaries\", \"fill-opacity\", 1);\n\n    // Zoom in after 4 seconds\n    setTimeout(function () {\n      map.easeTo({\n        center: JSON.parse(game.correctAnswer.centroid),\n        zoom: map.getZoom() < 5 ? map.getZoom() : 5,\n        duration: 6000,\n      });\n    }, 1000);\n  }\n\n  // Style the map to highlight a country\n  function styleMap(iso_3166_1) {\n    // Hide country labels\n    [\n      \"country-label\",\n      \"settlement-minor-label\",\n      \"settlement-major-label\",\n      \"poi-label\",\n      \"water-point-label\",\n      \"water-line-label\",\n      \"waterway-label\",\n      \"water-line-label\",\n      \"waterway-label\",\n      \"natural-point-label\",\n      \"natural-line-label\",\n      \"roads\",\n    ].forEach((layerId) =>\n      map.setLayoutProperty(layerId, \"visibility\", \"none\")\n    );\n\n    // Mask country boundary\n    map.setPaintProperty(\"country-boundaries\", \"fill-color\", [\n      \"case\",\n      [\"match\", [\"get\", \"iso_3166_1\"], [iso_3166_1], true, false],\n      \"hsla(0, 0%, 94%, 0)\",\n      [\"match\", [\"get\", \"disputed\"], [\"true\"], true, false],\n      \"hsla(36, 0%, 10%, 0.05)\",\n      \"hsla(36, 0%, 100%, 0.89)\",\n    ]);\n\n    // Style country outline and internal boundaries\n    map.setPaintProperty(\"country-boundaries-outline\", \"line-color\", [\n      \"match\",\n      [\"get\", \"iso_3166_1\"],\n      iso_3166_1,\n      \"orange\",\n      \"hsla(0, 0%, 100%, 0)\",\n    ]);\n\n    map.setPaintProperty(\"admin-boundaries-line\", \"line-color\", [\n      \"case\",\n      [\"match\", [\"get\", \"iso_3166_1\"], [iso_3166_1], true, false],\n      \"hsl(0, 0%, 100%)\",\n      [\"match\", [\"get\", \"disputed\"], [\"true\"], true, false],\n      \"hsla(0, 0%, 82%,0.5)\",\n      [\n        \"case\",\n        [\"==\", [\"get\", \"admin_level\"], 0],\n        \"hsla(0, 0%, 66%,0.5)\",\n        \"hsla(0, 0%, 66%,0)\",\n      ],\n    ]);\n\n    map.setLayoutProperty(\"country-label\", \"symbol-sort-key\", [\n      \"match\",\n      [\"get\", \"iso_3166_1\"],\n      iso_3166_1,\n      0,\n      1,\n    ]);\n\n    map.setLayoutProperty(\"settlement-minor-label\", \"symbol-sort-key\", [\n      \"match\",\n      [\"get\", \"iso_3166_1\"],\n      iso_3166_1,\n      0,\n      1,\n    ]);\n\n    // Highlight matching country and city labels\n    map.setPaintProperty(\"country-label\", \"text-opacity\", [\n      \"match\",\n      [\"get\", \"iso_3166_1\"],\n      iso_3166_1,\n      1,\n      0.3,\n    ]);\n    map.setPaintProperty(\"settlement-minor-label\", \"text-opacity\", [\n      \"match\",\n      [\"get\", \"iso_3166_1\"],\n      iso_3166_1,\n      1,\n      0.2,\n    ]);\n    map.setPaintProperty(\"settlement-major-label\", \"text-opacity\", [\n      \"match\",\n      [\"get\", \"iso_3166_1\"],\n      iso_3166_1,\n      1,\n      0.2,\n    ]);\n    map.setPaintProperty(\"settlement-minor-label\", \"icon-opacity\", [\n      \"match\",\n      [\"get\", \"iso_3166_1\"],\n      iso_3166_1,\n      1,\n      0.1,\n    ]);\n    map.setPaintProperty(\"settlement-major-label\", \"icon-opacity\", [\n      \"match\",\n      [\"get\", \"iso_3166_1\"],\n      iso_3166_1,\n      1,\n      0.1,\n    ]);\n    map.setPaintProperty(\"roads\", \"line-opacity\", [\n      \"match\",\n      [\"get\", \"iso_3166_1\"],\n      iso_3166_1,\n      1,\n      0,\n    ]);\n  }\n\n  // Check if chosen place is correct\n  function checkAnswer(code) {\n    game.endTurn = true;\n\n    window.scrollTo(0, 0);\n\n    // Show country labels\n    map.easeTo({\n      zoom: 3,\n      bearing: 0,\n      duration: 1000,\n    });\n    [\n      \"country-label\",\n      \"settlement-minor-label\",\n      \"settlement-major-label\",\n      \"poi-label\",\n      \"water-point-label\",\n      \"water-line-label\",\n      \"waterway-label\",\n      \"natural-point-label\",\n      \"natural-line-label\",\n      \"roads\",\n    ].forEach((layerId) =>\n      map.setLayoutProperty(layerId, \"visibility\", \"visible\")\n    );\n\n    if (code == game.correctAnswer.countryLabel.value) {\n      game.score += 1;\n      game.answerIsCorrect = true;\n\n      game.answerHistory[game.correctAnswer.wikidata_id].push(true);\n    } else {\n      game.answerIsCorrect = false;\n\n      game.answerHistory[game.correctAnswer.wikidata_id].push(false);\n    }\n\n    // Increase difficulty level dynamically\n    game.turn += 1;\n    if (game.answerIsCorrect && game.turn > 20 && game.score / game.turn > 0.8) {\n      settings.difficultyLevel = 2;\n    } else if (\n      game.answerIsCorrect &&\n      game.turn > 10 &&\n      game.score / game.turn > 0.4\n    ) {\n      settings.difficultyLevel = 1;\n    } else {\n      settings.difficultyLevel = 0;\n    }\n\n    game.choices = null;\n  }\n\n  // Retrieve commons thumbnail image from url\n  function commonsImage(filePath, width) {\n    return `${filePath}?width=${width}px`;\n  }\n\n  function removeIntro() {\n    game.showIntro = false;\n    nextTurn();\n  }\n</script>\n\n<style>\n  .flag {\n    border: 1px solid #eaeaea;\n  }\n</style>\n\n<Panel>\n  <main id=\"panel\" class=\"uk-position-absolute uk-padding-small uk-width-1-1\">\n    {#if game.showIntro}\n      {#if !game.dataLoaded}\n        <h4>\n          <div uk-spinner />\n          Loading list of countries.\n        </h4>\n      {:else}\n        <h1>Can you guess this country?</h1>\n        <button\n          on:click={removeIntro}\n          class=\"uk-button uk-button-primary uk-button-large uk-width-1-1\"\n          style=\"background-color:#1ba3e3\">\n          Let's get started!<br />\n        </button>\n      {/if}\n    {:else if game.choices}\n      <h4>Identify this territory in {game.correctAnswer.subregion}:</h4>\n      <p>\n        <small>\n          {#if settings.difficultyLevel == 0}\n\n          {:else if settings.difficultyLevel == 1}\n            {'Ferdinand Magellan mode activated! Check your map compass for North ' + settings.difficultyLevels[settings.difficultyLevel]}\n          {:else if settings.difficultyLevel == 2}\n            {'Marco Polo mode activated! Hiding country names ' + settings.difficultyLevels[settings.difficultyLevel]}\n          {/if}\n        </small>\n      </p>\n\n      <div class=\"uk-child-width-expand uk-grid-small uk-grid-match\" uk-grid>\n        {#each game.choices as choice}\n          <div\n            class=\"uk-width-1-1\"\n            on:click={checkAnswer(choice.countryLabel.value)}>\n            <div\n              data-qid={choice.wikidata_id}\n              class=\"uk-card uk-card-default uk-card-body uk-card-hover\">\n              <b>\n                {#if settings.difficultyLevel <= 1}\n                  {choice.countryLabel.value}\n                {:else if settings.difficultyLevel == 2}\n                  {choice.countryLabel.value.charAt(0) + choice.countryLabel.value.replace(/./g, '_')}\n                {/if}\n              </b>\n\n              {#if choice.hasOwnProperty('flag')}\n                <img\n                  class=\"uk-float-right flag\"\n                  alt=\"Flag of {choice.countryLabel.value}\"\n                  src={commonsImage(choice.flag.value, 50)} />\n              {/if}\n            </div>\n          </div>\n        {/each}\n      </div>\n      <p>\n        Score\n        {game.score}\n        /\n        {game.turn}\n        {#if game.turn > 0}({Math.round((game.score / game.turn) * 100)}%){/if}\n        <progress class=\"uk-progress\" value={game.score} max={game.turn} />\n      </p>\n    {:else if game.endTurn}\n      <div class=\"uk-margin-remove\" uk-alert>\n        {#if game.answerIsCorrect}\n          <h3>{game.correctAnswer.name_lang} is <b>correct</b> ✔</h3>\n        {:else}\n          <h3>Sorry, it was {game.correctAnswer.name_lang} ✘</h3>\n        {/if}\n        <p>\n          Score\n          {game.score}\n          /\n          {game.turn}\n          {#if game.turn > 0}\n            ({Math.round((game.score / game.turn) * 100)}%)\n          {/if}\n          <progress\n            class=\"uk-progress\"\n            value={game.score}\n            max={game.turn}\n            style=\"background-color:red\" />\n        </p>\n      </div>\n\n      <button\n        on:click={nextTurn}\n        class=\"uk-button uk-button-primary uk-button-large uk-width-1-1\"\n        style=\"background-color:#1ba3e3\"\n        href=\"#map\"\n        uk-scroll>\n        Try another\n      </button>\n\n      <div class=\"uk-card uk-card-default uk-margin-top\">\n        <div class=\"uk-card-header\">\n          <div class=\"uk-grid-small uk-flex-middle\" uk-grid>\n            <div class=\"uk-width-auto\">\n              {#if game.correctAnswer.wikidata.hasOwnProperty('flag')}\n                <a href={game.correctAnswer.wikidata.flag.value}>\n                  <img\n                    alt=\"Flag of {game.correctAnswer.wikidata.countryLabel.value}\"\n                    src=\"{game.correctAnswer.wikidata.flag.value}?width=100px\"\n                    class=\"flag\" />\n                </a>\n              {/if}\n            </div>\n            <div class=\"uk-width-expand uk-overflow-hidden\">\n              <h3 class=\"uk-card-title uk-margin-remove-bottom\">\n                {game.correctAnswer.name_lang}\n              </h3>\n\n              {#if game.correctAnswer.name_lang != game.correctAnswer.name}\n                <p class=\"uk-text-meta uk-margin-remove-top\">\n                  {game.correctAnswer.name}\n                </p>\n              {/if}\n              {#if game.correctAnswer.wikidata.hasOwnProperty('website')}\n                <a\n                  href={game.correctAnswer.wikidata.website.value}>{game.correctAnswer.wikidata.website.value}</a>\n              {/if}\n            </div>\n          </div>\n        </div>\n\n        {#if game.correctAnswer.wikidata.hasOwnProperty('pageBanner')}\n          <div class=\"uk-card-media-top\">\n            <img\n              alt=\"Header image of {game.correctAnswer.wikidata.countryLabel.value}\"\n              src=\"{game.correctAnswer.wikidata.pageBanner.value}?width={document.getElementById('panel').offsetWidth}px\" />\n          </div>\n        {/if}\n\n        <div class=\"uk-card-body\">\n          <p>\n            {#if game.correctAnswer.wikidata.hasOwnProperty('coatOfArms')}\n              <a href={game.correctAnswer.wikidata.coatOfArms.value}>\n                <img\n                  alt=\"Coat of arms of {game.correctAnswer.wikidata.countryLabel.value}\"\n                  src=\"{game.correctAnswer.wikidata.coatOfArms.value}?width=150px\" />\n              </a>\n              Coat of arms\n            {/if}\n          </p>\n\n          <ul class=\"uk-list\">\n            {#if game.correctAnswer.wikidata.hasOwnProperty('namedAfterLabels') && game.correctAnswer.wikidata.namedAfterLabels.value.length}\n              <li>\n                Country named after:\n                {game.correctAnswer.wikidata.namedAfterLabels.value}\n              </li>\n            {/if}\n\n            <!-- Skip ogg audio for Safari since it is unsupported -->\n            {#if !/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}\n              {#if game.correctAnswer.wikidata.hasOwnProperty('anthemAudio')}\n                <li>\n                  Anthem:\n                  {game.correctAnswer.wikidata.anthemLabel.value}\n                  <audio controls>\n                    <source\n                      type=\"audio/ogg\"\n                      src={game.correctAnswer.wikidata.anthemAudio.value.replace('http:', 'https:')} />\n                  </audio>\n                </li>\n              {/if}\n            {/if}\n\n            <li>\n              Capital:\n              {#if game.correctAnswer.wikidata.hasOwnProperty('capitalLabel')}\n                {game.correctAnswer.wikidata.capitalLabel.value}\n              {:else}None{/if}\n            </li>\n          </ul>\n          <h4>Languages</h4>\n          <ul class=\"uk-list\">\n            <li>\n              Official:\n              {#if game.correctAnswer.wikidata.hasOwnProperty('officialLanguageLabels')}\n                <b>{game.correctAnswer.wikidata.officialLanguageLabels.value.split(',').length}</b>\n                -\n                {game.correctAnswer.wikidata.officialLanguageLabels.value}\n              {:else}Unknown{/if}\n            </li>\n            <li>\n              Other:\n              {#if game.correctAnswer.wikidata.hasOwnProperty('spokenLanguageLabels')}\n                <b>{game.correctAnswer.wikidata.spokenLanguageLabels.value.split(',').length}</b>\n                -\n                {game.correctAnswer.wikidata.spokenLanguageLabels.value}\n              {:else}Unknown{/if}\n            </li>\n          </ul>\n        </div>\n        <div class=\"uk-card-footer\">\n          Data source:\n          <a\n            href={game.correctAnswer.wikidata.country.value}\n            class=\"uk-button uk-button-text\">Wikidata</a>\n        </div>\n      </div>\n    {/if}\n    <footer class=\"uk-margin-top\">\n      <small>❤️ Built with\n        <a href=\"https://docs.mapbox.com/mapbox-gl-js/api/\">Mapbox</a>,\n        <a href=\"https://www.openstreetmap.org/\">OpenStreetMap</a>,\n        <a href=\"https://www.wikidata.org/wiki/Wikidata:Main_Page\">Wikidata</a>\n        and\n        <a href=\"https://svelte.dev/\">Svelte</a>\n        |\n        <a href=\"https://github.com/planemad/map-quiz\">Source code</a></small>\n    </footer>\n  </main>\n</Panel>\n\n<Map\n  style={settings.mapStyle}\n  worldview={settings.mapWorldview}\n  locale={settings.locale}\n  qid={settings.startingCountryQid}\n  location={{ bounds: JSON.parse(countriesData.Q142.bounds), point: settings.userLocation }}\n  data={countriesData}\n  bind:map />\n",
    "<script>\n  import { onMount } from \"svelte\";\n  import mapbox from \"mapbox-gl\";\n\n  // Worldview for disputed areas.\n  // https://docs.mapbox.com/vector-tiles/reference/mapbox-boundaries-v3/#--polygon---worldview-text\n  export let worldview = \"US\";\n\n  // Initial map location\n  export let location = {\n    bounds: [\n      [-10.76, 49.864],\n      [1.863, 59.479],\n    ],\n  };\n  export let style;\n  export let map;\n  export let locale;\n  export let data;\n\n  let container;\n  let options;\n\n  let localeLanguage = locale.split(\"-\")[0] || \"en\";\n  let localeCountry = locale.split(\"-\")[1] || \"US\";\n\n  function resetView() {\n    map.fitBounds(location.bounds);\n  }\n\n  if (location.bounds) {\n    options = { bounds: location.bounds };\n  }\n\n  onMount(() => {\n    const link = document.createElement(\"link\");\n    link.rel = \"stylesheet\";\n    link.href = \"https://unpkg.com/mapbox-gl/dist/mapbox-gl.css\";\n\n    link.onload = () => {\n      \n      // Use Mapbox Labs token when served from labs.mapbox.com\n      const is_mapbox_hosted = window.location.href.indexOf(\"mapbox.com\") > -1 ? true : false;\n      mapbox.accessToken = is_mapbox_hosted ? \"pk.eyJ1IjoibGFicy1zYW5kYm94IiwiYSI6ImNrMTZuanRtdTE3cW4zZG56bHR6MnBkZG4ifQ.YGRP0sZNYdLw5_jSa9IvXg\" : \"pk.eyJ1IjoicGxhbmVtYWQiLCJhIjoiY2todmxnbDFyMDFmcDJ5cGthZ2Vqenh3OSJ9.Plw3yyu23yPZFPIiuatpKQ\";\n\n      map = new mapbox.Map({\n        container,\n        style: style,\n        interactive: true,\n        ...options,\n      });\n      // map.scrollZoom.disable();\n\n      mapbox.setRTLTextPlugin(\n        \"https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js\",\n        null,\n        true // Lazy load the plugin\n      );\n\n      var nav = new mapbox.NavigationControl();\n      map.addControl(nav, \"top-right\");\n\n      var scale = new mapbox.ScaleControl({\n        maxWidth: 80,\n      });\n      map.addControl(scale, \"bottom-right\");\n\n      map.on(\"load\", function () {\n        loadMapLayers();\n      });\n    };\n\n    document.head.appendChild(link);\n\n    return () => {\n      map.remove();\n      link.parentNode.removeChild(link);\n    };\n  });\n\n  function loadMapLayers() {\n    // Configure the worldview for the country boundaries tileset\n    // https://docs.mapbox.com/vector-tiles/reference/mapbox-countries-v1/\n\n    const worldviewFilter = [\n      \"all\",\n      [\n        \"any\",\n        [\"in\", worldview, [\"get\", \"worldview\"]],\n        [\"==\", \"all\", [\"get\", \"worldview\"]],\n      ],\n    ];\n\n    map.setFilter(\"country-boundaries\", worldviewFilter);\n    map.setFilter(\"country-boundaries-outline\", worldviewFilter);\n    map.setFilter(\"admin-boundaries-line\", worldviewFilter);\n\n    map.setLayoutProperty(\"country-label\", \"visibility\", \"none\");\n\n    // Set language of labels if supported\n    // https://docs.mapbox.com/vector-tiles/reference/mapbox-streets-v8/#name-text--name_lang-code-text\n    let supportedMapLanguages = [\n      \"ar\",\n      \"en\",\n      \"es\",\n      \"fr\",\n      \"de\",\n      \"it\",\n      \"pt\",\n      \"ru\",\n      \"zh-Hans\",\n      \"zh-Hant\",\n      \"ja\",\n      \"ko\",\n      \"vi\",\n    ];\n\n    // Disambiguate Chinese to simplified or traditional based on country\n    if ([\"zh\"].indexOf(localeLanguage) >= 0) {\n      if ([\"CN\"].indexOf(localeCountry) >= 0) {\n        localeLanguage = \"zh-Hans\";\n      }\n      if ([\"TW\", \"HK\", \"SG\"].indexOf(localeCountry) >= 0) {\n        localeLanguage = \"zh-Hant\";\n      }\n    }\n\n    let mapTextField;\n\n    // Use labels from mapbox-streets directly for supported languages\n    // Else join translations from Wikidata for country labels\n\n    // For country labels layer\n    if (supportedMapLanguages.indexOf(localeLanguage) >= 0) {\n      mapTextField = [\n        \"coalesce\",\n        [\"get\", \"name_\" + localeLanguage],\n        [\"get\", \"name\"],\n      ];\n      map.setLayoutProperty(\"country-label\", \"text-field\", mapTextField);\n    } else {\n      let joinTranslationExpression = [\"match\", [\"get\", \"iso_3166_1\"]];\n\n      \n\n      Object.keys(data).forEach((qid) => {\n        joinTranslationExpression.push([data[qid].iso_3166_1]);\n        joinTranslationExpression.push(data[qid].name_lang);\n      });\n      joinTranslationExpression.push(\"\");\n\n      console.log(joinTranslationExpression)\n\n      map.setLayoutProperty(\n        \"country-label\",\n        \"text-field\",\n        joinTranslationExpression\n      );\n\n      mapTextField = [\"coalesce\", [\"get\", \"name_en\"], [\"get\", \"name\"]];\n    }\n\n    // For other labels layer\n\n    [\"settlement-minor-label\",\"settlement-major-label\",\"poi-label\",\"water-point-label\",\"water-line-label\",\"waterway-label\",\"natural-point-label\",\"natural-line-label\"].forEach(layerId=>\n      map.setLayoutProperty(layerId, \"text-field\", mapTextField)\n    )\n\n    // Add new boundary to the map\n\n    map.addLayer({\n      id: \"capital-location\",\n      type: \"circle\",\n      source: {\n        type: \"geojson\",\n        data: null,\n      },\n      paint: {\n        \"circle-radius\": 3,\n        \"circle-color\": \"hsla(355, 100%, 50%, 0.5)\",\n        \"circle-stroke-color\": \"white\",\n        \"circle-stroke-width\": 1,\n      },\n      layout: {},\n    });\n  }\n</script>\n\n<style>\n  div {\n    width: 60%;\n    height: 100%;\n    position: fixed;\n    right: 0;\n  }\n  @media (max-width: 1000px) {\n    div {\n      width: 100%;\n      height: 60%;\n      position: absolute;\n    }\n  }\n</style>\n\n<div id=\"map\" bind:this={container}>\n  {#if map}\n    <slot />\n  {/if}\n</div>\n",
    "<style>\n\tdiv {\n\t\tz-index: 2;\n\t\twidth: 40%;\n\t\tposition: absolute;\n\t}\n\t@media (max-width: 1000px) {\n\t\tdiv {\n\t\t\twidth: 100%;\n\t\t\ttop: 60%;\n\t\t}\n\t}\n\n</style>\n\n<div>\n\t<slot></slot>\n</div>"
  ],
  "names": [],
  "mappings": "AA+fE,KAAK,eAAC,CAAC,AACL,MAAM,CAAE,GAAG,CAAC,KAAK,CAAC,OAAO,AAC3B,CAAC;ACpUD,GAAG,cAAC,CAAC,AACH,KAAK,CAAE,GAAG,CACV,MAAM,CAAE,IAAI,CACZ,QAAQ,CAAE,KAAK,CACf,KAAK,CAAE,CAAC,AACV,CAAC,AACD,MAAM,AAAC,YAAY,MAAM,CAAC,AAAC,CAAC,AAC1B,GAAG,cAAC,CAAC,AACH,KAAK,CAAE,IAAI,CACX,MAAM,CAAE,GAAG,CACX,QAAQ,CAAE,QAAQ,AACpB,CAAC,AACH,CAAC;ACxMF,GAAG,eAAC,CAAC,AACJ,OAAO,CAAE,CAAC,CACV,KAAK,CAAE,GAAG,CACV,QAAQ,CAAE,QAAQ,AACnB,CAAC,AACD,MAAM,AAAC,YAAY,MAAM,CAAC,AAAC,CAAC,AAC3B,GAAG,eAAC,CAAC,AACJ,KAAK,CAAE,IAAI,CACX,GAAG,CAAE,GAAG,AACT,CAAC,AACF,CAAC"
}